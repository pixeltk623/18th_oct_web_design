<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>
	<style type="text/css">
		table tr th,td {
			padding: 15px;
		}
		table {
			margin: auto;
		}
	</style>
</head>
<body>

<h1 style="text-align:center;">API</h1>
<a href="" style="display:inline-block; margin-left:133px;">Add New User</a>
<br><br>

<div style="margin-left:133px;">
	<form method="post" id="myForm">
		<div>
			<label>Name: </label>
			<input type="text" name="name" id="name">
		</div>
		<br>
		<div>
			<label>Email: </label>
			<input type="text" name="email" id="email">
		</div>
		<br>
		<div>
			<label>Mobile: </label>
			<input type="text" name="mobile" id="mobile">
		</div>
		<br>
		<input type="submit" name="Submit" onclick="return datInsert()">
		<br><br>
	</form>
</div>

<div id="table"></div>
<script type="text/javascript">

	getMainTable();

	function getMainTable() {
		const API_URL = "http://localhost/api_web/get.php";

		var xmlHttp = new XMLHttpRequest();
	    xmlHttp.open( "GET", API_URL, false ); // false for synchronous request
	    xmlHttp.send( null );
	    allData =  JSON.parse(xmlHttp.responseText);

		console.log(allData);
		let table = '';
		table += '<table border="1" style="border-collapse: collapse; width: 80%;">';
		table +=	'<tr>';
		table +=		'<th>Sl.No</th>';
		table +=		'<th>Name</th>';
		table +=		'<th>Email</th>';
		table +=		'<th>Mobile</th>';
		table +=		'<th>Action</th>';
		table +=	'</tr>';

		if(allData.status==200) {
			for(let i=0; i<allData.data.length; i++) {
				table +=	'<tr>';
					table +=		'<td>'+(i+1)+'</td>';
					table +=		'<td>'+allData.data[i].name+'</td>';
					table +=		'<td>'+allData.data[i].email+'</td>';
					table +=		'<td>'+allData.data[i].mobile+'</td>';
					table +=		'<td> <button>Show</button> <button>Edit</button> <button type="button" onclick="DeleteRecord('+allData.data[i].id+')">Delete</button> </td>';
				table +=	'</tr>';
			}
		} else {
			table +=	'<tr>';
				table +=		'<th colspan="5" style="text-aligin: center; color:red;">'+allData.data+'</th>';
			table +=	'</tr>';
		}

		table +='</table>';



		document.getElementById("table").innerHTML = table;
	}

	//console.log(table)


	function datInsert() {
		let userName = document.getElementById('name').value;
		let email = document.getElementById('email').value;
		let mobile = document.getElementById('mobile').value;

		//console.log(userName, email, mobile)

		const API_URL_INSERT = "http://localhost/api_web/insert.php";

		var xhr = new XMLHttpRequest();
		xhr.open("POST", API_URL_INSERT, false);
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.send(JSON.stringify({
		    name: userName,
		    email: email,
		    mobile: mobile
		}));

		if(xhr.status==200) {
			document.getElementById("myForm").reset();
			getMainTable()
		}
		
		return false;
	}

	function DeleteRecord(id) {
		const API_URL_INSERT = "http://localhost/api_web/delete.php";

		var xhr = new XMLHttpRequest();
		xhr.open("POST", API_URL_INSERT, false);
		xhr.setRequestHeader('Content-Type', 'application/json');
		xhr.send(JSON.stringify({
		    did: id
		}));

		if(xhr.status==200) {
			//
			getMainTable()
		}
	}
</script>
</body>
</html>